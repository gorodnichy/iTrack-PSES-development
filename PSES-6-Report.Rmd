
# Generate Report

<!-- ## Report  -->


<!-- Not available in Light version.   -->
<!-- Please contact developer to obtain Full version. -->



## Page 2 {data-orientation=rows}

### Generated by [iTrack](https://itrack.shinyapps.io/PSES) on `r format(Sys.time(), "%d %B, %Y")`.  

**Public Service Employee Survey Results**

```{r }

setkeyv(dtDepartments,PSES_ID_COLS)
renderText({
  dt <- dtDepartments[ as.list(r.myID())]
  #   dt <- dtDepartments[ .(c(id1(),id2(),id3(),id4(),id5() ) )]
  sprintf("Level: %i. %s (%s, ID=%i.%i.%i.%i.%i)" , 
          dt$IDlevel, dt$Organization, dt$AADD, 
          id1(),id2(),id3(),id4(),id5())
})
```

<!-- Department: `r dtDepartments[ as.list(r.myID())]`  -->

<!-- Years: `2011,2014,2017,2018` -->

**Abstract: **


The following report is generated automatically from [Public Service Employee Survey (PSES)](https://www.canada.ca/en/treasury-board-secretariat/services/innovation/public-service-employee-survey.html) results data. 
It identifies the areas of leadership and concerns for  `SCIENCE AND ENGINEERING`, comparing its performance to that of other departments within the same orgzanization, and to its own performance in the past.

The performance is measured using the so-called *"Happy" Score*, which is the weighted ratio of *Positive Responses* to *All Responses* to PSES questions: 

<!-- The Score is computed as assigning a score of 100 to the most positive response category, 75 to the second most positive response category, 50 for the middle response category, 25 to the second most negative response option, and 0 to the most negative response option.  -->

$$ Score  = { 100 \cdot Strongly\ agree  + 75 \cdot Somewhat\ agree + 50\cdot Neutral + 25 \cdot Somewhat \ disagree + 0\cdot Strongly\ disagree \over 
Strongly\ agree  + Somewhat\ agree  + Neutral + Somewhat\ disagree + Strongly\ disagree  } (\%) $$



#### Performance summary

<!-- 
```{r  warning=FALSE, echo=F, fig.height = 6, fig.width = 12, fig.align = "center"}


renderPlot({
  Rank.T <- 20
  
  myID <<- r.myID()
  
  setkeyv(dtDepartments,PSES_ID_COLS)  
  dtRESULT <<- dtPSES[SURVEYR %in% c(2018)][
    selectDepts (id=myID), on=PSES_ID_COLS][
      dtQuestions, on="QUESTION"]
  
  setkeyv(dtRESULT, PSES_ID_COLS)
  #q <- (dtRESULT$QUESTION %>% unique)[2];q
  for (q in dtRESULT$QUESTION %>% unique) {
    myScore <- dtRESULT[as.list(myID)][QUESTION==q]$SCORE100; myScore
    # myRank <- dtPSES[QUESTION==q &  SCORE100 > myScore, .N] ; myRank
    dtRESULT[QUESTION==q, ':=' (
      RANK=dtPSES[QUESTION==q & LEVEL1ID > 0 &  SCORE100 > myScore, .N],
      TOTAL=dtPSES[QUESTION==q & LEVEL1ID > 0, .N]       )
      ] [, RANK100:=round(RANK/TOTAL*100)]
    #  dtRESULT[QUESTION==q & IDlevel == 0, ':=' (RANK100=50)]
  }
  
  
  
  g <-  plotPSES.layout()  + 
    guides(col= guide_legend("Theme")) + 
    theme(legend.position = "bottom")  +    
    annotation_raster(image_smileys, xmin = 46, xmax = 54, ymin = 0, ymax = 5) +
    
    geom_point(data=dtRESULT[IDlevel==getLevel(myID)],mapping=aes(SCORE100, Question.Abbreviated, col=as.ordered(Theme)) , size=7, alpha=0.8) +
    
    geom_label(data=dtRESULT[IDlevel==getLevel(myID)],mapping=aes(SCORE100, Question.Abbreviated, label=RANK100) ,  alpha=0.4) +
    
    geom_point(data=dtRESULT[IDlevel==0],mapping=aes(SCORE100, Question.Abbreviated), 
               size=7,  shape=3, col="black") + # shape=15)
    
    
    geom_point(data=dtRESULT[as.integer(IDlevel)>getLevel(myID)],mapping=aes(SCORE100, Question.Abbreviated, col=as.ordered(Theme)), size=2, alpha=0.1) 
  # + 
  #   
  #   geom_point(data=dtRESULT[level==myLevel(id)+2],mapping=aes(SCORE100, Question.Abbreviated, col=as.ordered(Theme)), size=1, alpha=0.6) 
  #   
  #   
  
  
  g + 
    labs(
      x="Score = Positive responses / All responses (%)",
      y=NULL,
      title=paste("2018 Public Service Employee Survey Results"), 
      subtitle=paste0("Department: ",
                      # "Department:", dtDepartments[as.list(myID)]$pathString, 
                      dtDepartments[as.list(myID0)]$Organization,
                      " \n(Ranking percentile is indicated in the box, Public Service average is marked by cross)"),
      caption = paste0("License: Open Government Licence - Canada\n Generated", #  on ", format(Sys.time(), "%d %B, %Y"), 
                       " by iTrack (https://itrack.shinyapps.io/PSES)")
    ) 
  
  
})
```
-->

End32

<!-- 

#### Areas of Leadership:

Areas of Leadership are the areas where the department ranked in Top `r Rank.T`% of Public Service in its performance. For `SCIENCE AND ENGINEERING` these areas are the following:

```{r}

renderPrint({
  dtRESULT[as.list(r.myID())][RANK100 <=Rank.T, .(Theme, QUESTION, SCORE100, RANK100)]
})
```


#### Areas of Concern:


Areas of Concern are the  areas where the deparment ranked in Bottom `r Rank.T`% of Public Service in its performance. For `SCIENCE AND ENGINEERING` these areas are the following:

```{r}


renderPrint({
# dtRESULT[as.list(myID0)][RANK100 >= 100-Rank.T, .(Theme, QUESTION, SCORE100, RANK100)][order(-RANK100)]
dtRESULT[as.list(r.myID())][RANK100 >= 100-Rank.T, .(
  Theme, QUESTION,
  #Question... = str_trunc(Question.Abbreviated, 44,ellipsis = ".."), 
  RANK100, SCORE100 )][order(-RANK100)]
# dtRESULT[as.list(myID0)][RANK100 >= 100-Rank.T, .(Theme, RANK100, SCORE100, Question.Abbreviated)][order(-RANK100)]
})


```

-->

end 1
<!-- 
#### Comparison to other departments within the same organization:


```{r  warning=FALSE, echo=F, fig.height = 6, fig.width = 12, fig.align = "center"}


if (F) {
  myID <<- r.myID()
  
  myLevel=getLevel(myID)
  myID = getIDupto(myID0,myLevel-1);
  
  
  setkeyv(dtDepartments,PSES_ID_COLS)  
  dtRESULT <<- dtPSES[SURVEYR %in% c(2018)][
    selectDepts (id=myID), on=PSES_ID_COLS][
      dtQuestions, on="QUESTION"]
  
  setkeyv(dtRESULT, PSES_ID_COLS)
  #q <- (dtRESULT$QUESTION %>% unique)[2];q
  for (q in dtRESULT$QUESTION %>% unique) {
    myScore <- dtRESULT[as.list(myID)][QUESTION==q]$SCORE100; myScore
    myRank <- dtPSES[QUESTION==q &  SCORE100 > myScore, .N] ; myRank
    dtRESULT[QUESTION==q, ':=' (
      RANK=dtPSES[QUESTION==q & LEVEL1ID > 0 &  SCORE100 > myScore, .N],
      TOTAL=dtPSES[QUESTION==q & LEVEL1ID > 0, .N]       )
      ] [, RANK100:=round(RANK/TOTAL*100)]
    dtRESULT[QUESTION==q & IDlevel == 0, ':=' (RANK100=50)]
  }
  
  
  Questions_vs_Scores(T) +
    labs(
      x="Score = Positive responses / All responses (%)",
      y=NULL,
      title=paste("2018 Public Service Employee Survey Results"), 
      subtitle=paste0("Department: ",
                      # "Department:", dtDepartments[as.list(myID)]$pathString, 
                      dtDepartments[as.list(myID)]$Organization,
                      "\n(Ranking percentile is indicated in the box, Public Service average is marked by cross)"),
      caption = paste0("License: Open Government Licence - Canada\n Generated", #  on ", format(Sys.time(), "%d %B, %Y"), 
                       " by iTrack (https://itrack.shinyapps.io/PSES)")
    ) 
}


renderPrint({
  concerns <- dtRESULT[as.list(r.myID())][RANK100 >= 100-Rank.T]$QUESTION; 
  
  if (F) {
    for (t in dtRESULT$Theme %>% unique ) {
      cat(paste0("\n\n", t, "\n"))
      
      for (q in dtRESULT$QUESTION%>% unique ) {
        cat(paste0(dtRESULT[QUESTION==q]$Question%>% unique , "\n\n SCORE100"))
        
        cat(
          sprintf("%s: %i  ", 
                  dtRESULT[Theme == t & q %in% concerns & IDlevel==4]$pathString, 
                  dtRESULT[Theme == t & q %in% concerns & IDlevel==4]$SCORE100
          )
        )
      }
    }
    
  }
  
})




```

-->
End 

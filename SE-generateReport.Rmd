

# Generate Report 


## Page 2 {data-orientation=rows}

### Generated by [iTrack](https://itrack.shinyapps.io/PSES) on `r format(Sys.time(), "%d %B, %Y")`.  

**Public Service Employee Survey Results**

Department: `SCIENCE AND ENGINEERING` 

<!-- Years: `2011,2014,2017,2018` -->

**Abstract: **


The following report is generated automatically from [Public Service Employee Survey (PSES)](https://www.canada.ca/en/treasury-board-secretariat/services/innovation/public-service-employee-survey.html) results data. 
It identifies the areas of leadership and concerns for  `SCIENCE AND ENGINEERING`, comparing its performance to that of other departments within the same orgzanization, and to its own performance in the past.

The performance is measured using the so-called *"Happy" Score*, which is the weighted ratio of *Positive Responses* to *All Responses* to PSES questions: 

<!-- The Score is computed as assigning a score of 100 to the most positive response category, 75 to the second most positive response category, 50 for the middle response category, 25 to the second most negative response option, and 0 to the most negative response option.  -->

$$ Score  = { 100 \cdot Strongly\ agree  + 75 \cdot Somewhat\ agree + 50\cdot Neutral + 25 \cdot Somewhat \ disagree + 0\cdot Strongly\ disagree \over 
Strongly\ agree  + Somewhat\ agree  + Neutral + Somewhat\ disagree + Strongly\ disagree  } (\%) $$

---

#### Performance summary


```{r  computeRank, warning=FALSE, echo=F, fig.height = 6, fig.width = 12, fig.align = "center"}

Rank.T <- 20


if (F) {
  dtRESULT[ , Question.Abbreviated := as.character(Question.Abbreviated)]

  if (input$sortby =="name"){
    dtRESULT[ , Question.Abbreviated := reorder(Question.Abbreviated , nTheme )]
  } else if (input$sortby =="number of responses"){
    dtRESULT[ , Question.Abbreviated := reorder(Question.Abbreviated, ANSCOUNT)]
  } else if (input$sortby =="score"){
    dtRESULT[ , Question.Abbreviated := reorder(Question.Abbreviated , -SCORE100) ]
  } else {
    dtRESULT[ , Question.Abbreviated := reorder(Question.Abbreviated , RANK0) ]
  }
}
#@dtRESULT[ , Question.Abbreviated := reorder(Question.Abbreviated , nTheme )]


myID <- myID0 # <--- MY LEVEL ----
myID = myID0 # getIDupto(myID0,3); 

setkeyv(dtDepartments,PSES_ID_COLS)  
dtRESULT <<- dtPSES[SURVEYR %in% c(2018)][
  selectDepts (id=myID), on=PSES_ID_COLS][
    dtQuestions, on="QUESTION"]

setkeyv(dtRESULT, PSES_ID_COLS)
#q <- (dtRESULT$QUESTION %>% unique)[2];q
for (q in dtRESULT$QUESTION %>% unique) {
  myScore <- dtRESULT[as.list(myID)][QUESTION==q]$SCORE100; myScore
  
  myRank <- dtPSES[QUESTION==q &  SCORE100 > myScore, .N] ; 
  TOTAL   = dtPSES[QUESTION==q & LEVEL1ID > 0, .N] 
  
  myRank1 <- dtPSES[QUESTION==q & LEVEL1ID==myID[1] & SCORE100 > myScore, .N] ; 
  TOTAL1   = dtPSES[QUESTION==q & LEVEL1ID==myID[1] & LEVEL2ID > 0, .N] 
  
  myRANK_IN_BRANCH <- dtPSES[QUESTION==q & LEVEL1ID==myID[1] & LEVEL2ID==myID[2] & SCORE100 > myScore, .N] ; 
  TOTAL2   = dtPSES[QUESTION==q & LEVEL1ID==myID[1] & LEVEL2ID==myID[2] & LEVEL3ID > 0, .N] 
  
  dtRESULT[QUESTION==q, ':=' (
    RANK0=round(myRank/TOTAL*100),
    RANK1=round(myRank1/TOTAL1*100),
    RANK_IN_BRANCH=round(myRANK_IN_BRANCH/TOTAL2*100)
  )]
  #  dtRESULT[QUESTION==q & IDlevel == 0, ':=' (RANK0=50)]
}


Questions_vs_Scores() +

labs(
  x="Score = Positive responses / All responses (%)",
  y=NULL,
  title=paste("2018 Public Service Employee Survey Results"), 
  subtitle=paste0("Department: ",
                  # "Department:", dtDepartments[as.list(myID)]$pathString, 
                  dtDepartments[as.list(myID0)]$Organization,
                  " \n(Ranking percentile is indicated in the box, Public Service average is marked by cross)"),
  caption = paste0("License: Open Government Licence - Canada\n Generated", #  on ", format(Sys.time(), "%d %B, %Y"), 
                   " by iTrack (https://itrack.shinyapps.io/PSES)")
) 

```


---

#### Areas of Leadership:

Areas of Leadership are the areas where the department ranked in Top `r Rank.T`% of Public Service in its performance. For `SCIENCE AND ENGINEERING` these areas are the following:

```{r}


dtRESULT[as.list(myID0)][
  RANK0 <=Rank.T, .(Theme, QUESTION, SCORE100, RANK0,RANK_IN_BRANCH, Question.Abbreviated)]
```

---

#### Areas of Concern:


Areas of Concern are the  areas where the deparment ranked in Bottom `r Rank.T`% of Public Service in its performance. For `SCIENCE AND ENGINEERING` these areas are the following:

```{r}

dtRESULT[as.list(myID0)][
  # , Q := str_trunc(Question.Abbreviated, 22,ellipsis = "..")][
  RANK0 >= 100-Rank.T, .(
    Theme, QUESTION, SCORE100,    RANK0,    RANK_IN_BRANCH,
    Question.Abbreviated)][order(-RANK0)]

if (F) {
  dtRESULT[as.list(myID0)][
    # , Q := str_trunc(Question.Abbreviated, 22,ellipsis = "..")][
    RANK1 >= 100-Rank.T, .(
      Theme, QUESTION, SCORE100,    RANK0,  RANK1,   RANK_IN_BRANCH,
      Question.Abbreviated)][order(-RANK1)]
  
  dtRESULT[as.list(myID0)][
    # , Q := str_trunc(Question.Abbreviated, 22,ellipsis = "..")][
    RANK_IN_BRANCH >= 100-Rank.T, .(
      Theme, QUESTION, SCORE100,    RANK0,  RANK1, RANK_IN_BRANCH,
      Question.Abbreviated)][order(-RANK_IN_BRANCH)]
  
}

concerns <- dtRESULT[as.list(myID0)][RANK0 >= 100-Rank.T]$Question.Abbreviated; 

# concerns

```
<!-- `RANK_IN_BRANCH` indicates the ranking in comparison to other groups at the same level of the organization -->

***
  
#### Comparison to other departments within the same organization:
  
  
```{r  warning=FALSE, echo=F, fig.height = 6, fig.width = 12, fig.align = "center"}

myID <- myID0
myID = getIDupto(myID0,3); # <--- LEVEL UP ----

setkeyv(dtDepartments,PSES_ID_COLS)  
dtRESULT <<- dtPSES[SURVEYR %in% c(2018)][
  selectDepts (id=myID), on=PSES_ID_COLS][
    dtQuestions, on="QUESTION"]

setkeyv(dtRESULT, PSES_ID_COLS)
#q <- (dtRESULT$QUESTION %>% unique)[2];q

for (q in dtRESULT$QUESTION %>% unique) {
  myScore <- dtRESULT[as.list(myID)][QUESTION==q]$SCORE100; myScore
  myRank <- dtPSES[QUESTION==q &  SCORE100 > myScore, .N] ; myRank
  dtRESULT[QUESTION==q, ':=' (
    RANK=dtPSES[QUESTION==q & LEVEL1ID > 0 &  SCORE100 > myScore, .N],
    TOTAL=dtPSES[QUESTION==q & LEVEL1ID > 0, .N]       )
    ] [, RANK0:=round(RANK/TOTAL*100)]
  dtRESULT[QUESTION==q & IDlevel == 0, ':=' (RANK0=50)]
}

if (T) {
  Questions_vs_Scores(T) +
    labs(
      x="Score = Positive responses / All responses (%)",
      y=NULL,
      title=paste("2018 Public Service Employee Survey Results"), 
      subtitle=paste0("Department: ",
                      # "Department:", dtDepartments[as.list(myID)]$pathString, 
                      dtDepartments[as.list(myID)]$Organization,
                      "\n(Ranking percentile is indicated in the box, Public Service average is marked by cross)"),
      caption = paste0("License: Open Government Licence - Canada\n Generated", #  on ", format(Sys.time(), "%d %B, %Y"), 
                       " by iTrack (https://itrack.shinyapps.io/PSES)")
    ) 
}

if (F) { # TODO later
  for (t in dtRESULT$Theme %>% unique ) {
    cat(paste0("\n\n", t, "\n"))
    
    for (q in dtRESULT$QUESTION%>% unique ) {
      cat(paste0(dtRESULT[QUESTION==q]$Question%>% unique , "\n\n SCORE100"))
      
      cat(
        sprintf("%s: %i  ", 
                dtRESULT[Theme == t & q %in% concerns & IDlevel==4]$pathString, 
                dtRESULT[Theme == t & q %in% concerns & IDlevel==4]$SCORE100
        )
      )
    }
  }
  
}



```



---

#### Comparison to previous years:


```{r echo=FALSE, results='asis'}

for (t in unique(dtSED$Theme)) {
if (is.na(t) ) next

cat(glue::glue("\n\n\n*Theme: {t}* \n\n\n "))

for (q in unique(dtSED[Theme==t]$strQuestion)) {
#cat(glue::glue("\n\n\n*{q}*\n\n\n")) 
# cat(glue::glue("\n\n\n####  Q: \n\n\n")) 
#    print(knitr::kable(dtSED[strQuestion==q, 1:11]))
psesSED.plotQuestionByTime_lines(dtSED[strQuestion==q], q)

"<br><br><p>"
}
}



```
